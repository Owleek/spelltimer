import { useContext, useEffect } from 'react';
import { useSelector } from 'react-redux';
import ErrorComponent from '../../shared/ui/ErrorComponent/ErrorComponent';
import PageContext, { EPage } from '../../shared/store/PageContext';
import {TStoreState} from '../../shared/store/store';
import LangSelector from './subwidgets/LangSelector/LangSelector';
import PlayButton from '../../widgets/TimerPanel/PlayButton/PlayButton';
import cn from 'classnames';
import './header.scss';

interface IProps {
    className?: string
    isPlaygroundButtonShown?: boolean
    hideLogoOnMobile?: boolean
}

const Header = ({className, isPlaygroundButtonShown, hideLogoOnMobile}: IProps) => {
    const context = useContext(PageContext);

    if (!context) return <ErrorComponent message={String(context)}/>

    const {onSelectArticle, headerBottomOnMobile} = context;
    const handleClick = () => onSelectArticle(null);

    const {currentLang} = useSelector((state: TStoreState) => state.localeSlice);

    useEffect(() => {
        document.body.classList.toggle('textRight', currentLang === 'ar');
    }, [currentLang]);

    return (
        <div className={cn('header', className, {alignCenter: !!isPlaygroundButtonShown, hideLogoOnMobile, headerBottomOnMobile})}>
            <div className="header__logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 494 217" onClick={handleClick}>
                    <path d="M121.327 216.352C120.233 216.352 119.368 216.193 118.73 215.874C118.092 215.555 117.613 215.076 117.294 214.438C116.975 213.755 116.816 212.889 116.816 211.84V135.415H93.0948C92.0011 135.415 91.1352 135.255 90.4972 134.936C89.8591 134.617 89.3806 134.139 89.0616 133.501C88.7426 132.863 88.5831 131.997 88.5831 130.903V122.221C88.5831 121.173 88.7426 120.33 89.0616 119.692C89.3806 119.008 89.8591 118.507 90.4972 118.188C91.1808 117.869 92.0466 117.71 93.0948 117.71H162.138C163.186 117.71 164.029 117.869 164.667 118.188C165.351 118.507 165.852 119.008 166.171 119.692C166.49 120.33 166.65 121.173 166.65 122.221V130.903C166.65 131.951 166.49 132.817 166.171 133.501C165.852 134.139 165.351 134.617 164.667 134.936C164.029 135.255 163.186 135.415 162.138 135.415H138.417V211.84C138.417 212.889 138.258 213.755 137.939 214.438C137.62 215.076 137.118 215.555 136.435 215.874C135.797 216.193 134.954 216.352 133.905 216.352H121.327Z"/>
                    <path d="M181.962 216.352C180.914 216.352 180.048 216.193 179.364 215.874C178.726 215.555 178.248 215.076 177.929 214.438C177.61 213.755 177.45 212.889 177.45 211.84V122.221C177.45 121.173 177.61 120.33 177.929 119.692C178.248 119.008 178.726 118.507 179.364 118.188C180.048 117.869 180.914 117.71 181.962 117.71H194.54C195.588 117.71 196.431 117.869 197.069 118.188C197.753 118.507 198.254 119.008 198.573 119.692C198.892 120.33 199.052 121.173 199.052 122.221V211.84C199.052 212.889 198.892 213.755 198.573 214.438C198.254 215.076 197.753 215.555 197.069 215.874C196.431 216.193 195.588 216.352 194.54 216.352H181.962Z"/>
                    <path d="M219.081 216.352C218.033 216.352 217.167 216.193 216.483 215.874C215.845 215.555 215.367 215.076 215.048 214.438C214.729 213.755 214.569 212.889 214.569 211.84V122.221C214.569 121.173 214.729 120.33 215.048 119.692C215.367 119.008 215.845 118.507 216.483 118.188C217.167 117.869 218.033 117.71 219.081 117.71H235.487C236.536 117.71 237.401 117.823 238.085 118.051C238.769 118.279 239.338 118.667 239.794 119.213C240.25 119.76 240.683 120.535 241.093 121.538L266.864 187.163H267.275L293.046 121.538C293.411 120.535 293.821 119.76 294.276 119.213C294.778 118.667 295.37 118.279 296.054 118.051C296.737 117.823 297.603 117.71 298.651 117.71H315.058C316.106 117.71 316.949 117.869 317.587 118.188C318.271 118.507 318.772 119.008 319.091 119.692C319.41 120.33 319.569 121.173 319.569 122.221V211.84C319.569 212.889 319.387 213.755 319.023 214.438C318.704 215.076 318.225 215.555 317.587 215.874C316.949 216.193 316.083 216.352 314.989 216.352H304.872C303.824 216.352 302.958 216.193 302.275 215.874C301.636 215.555 301.135 215.076 300.771 214.438C300.452 213.755 300.315 212.889 300.36 211.84V150.795H290.312L311.845 120.444L275.136 212.524C274.771 213.527 274.361 214.301 273.905 214.848C273.45 215.395 272.88 215.783 272.196 216.01C271.513 216.238 270.647 216.352 269.599 216.352H264.54C263.446 216.352 262.558 216.238 261.874 216.01C261.236 215.783 260.666 215.395 260.165 214.848C259.709 214.301 259.299 213.527 258.935 212.524L222.294 120.444L243.759 150.795H233.778V211.84C233.778 212.889 233.619 213.755 233.3 214.438C232.981 215.076 232.48 215.555 231.796 215.874C231.158 216.193 230.315 216.352 229.267 216.352H219.081Z"/>
                    <path d="M339.735 216.352C338.687 216.352 337.844 216.193 337.206 215.874C336.568 215.555 336.067 215.076 335.702 214.438C335.383 213.755 335.224 212.889 335.224 211.84V122.221C335.224 121.173 335.383 120.33 335.702 119.692C336.021 119.008 336.5 118.507 337.138 118.188C337.821 117.869 338.687 117.71 339.735 117.71H396.542C397.59 117.71 398.433 117.869 399.071 118.188C399.755 118.507 400.256 119.008 400.575 119.692C400.94 120.33 401.122 121.173 401.122 122.221V130.903C401.122 131.951 400.94 132.817 400.575 133.501C400.256 134.139 399.755 134.617 399.071 134.936C398.433 135.255 397.59 135.415 396.542 135.415H356.894V158.178H394.081C395.129 158.178 395.972 158.338 396.61 158.657C397.248 158.976 397.727 159.477 398.046 160.161C398.411 160.799 398.593 161.642 398.593 162.69V170.415C398.593 171.508 398.411 172.374 398.046 173.012C397.727 173.65 397.248 174.129 396.61 174.448C395.972 174.767 395.107 174.926 394.013 174.926H356.894V198.647H396.542C397.59 198.647 398.433 198.807 399.071 199.126C399.755 199.445 400.256 199.946 400.575 200.63C400.94 201.268 401.122 202.111 401.122 203.159V211.84C401.122 212.889 400.94 213.755 400.575 214.438C400.256 215.076 399.755 215.555 399.071 215.874C398.433 216.193 397.59 216.352 396.542 216.352H339.735Z"/>
                    <path d="M419.853 216.352C418.804 216.352 417.939 216.193 417.255 215.874C416.617 215.555 416.138 215.076 415.819 214.438C415.5 213.755 415.341 212.889 415.341 211.84V122.221C415.341 121.173 415.5 120.33 415.819 119.692C416.138 119.008 416.617 118.507 417.255 118.188C417.939 117.869 418.804 117.71 419.853 117.71H456.493C464.013 117.71 470.439 118.986 475.771 121.538C481.103 124.044 485.181 127.667 488.007 132.407C490.832 137.146 492.245 142.866 492.245 149.565V149.702C492.245 156.128 490.65 161.87 487.46 166.928C484.316 171.987 480.032 175.61 474.608 177.797L492.587 211.43C493.088 212.387 493.271 213.23 493.134 213.96C493.043 214.643 492.701 215.213 492.108 215.669C491.516 216.124 490.673 216.352 489.579 216.352H474.745C473.651 216.352 472.763 216.261 472.079 216.079C471.441 215.851 470.849 215.486 470.302 214.985C469.801 214.438 469.322 213.709 468.866 212.797L452.665 181.01C452.483 181.01 452.301 181.01 452.118 181.01C451.936 181.01 451.754 181.01 451.571 181.01H436.942V211.84C436.942 212.889 436.783 213.755 436.464 214.438C436.145 215.076 435.644 215.555 434.96 215.874C434.322 216.193 433.479 216.352 432.431 216.352H419.853ZM436.942 164.809H454.101C459.068 164.809 462.965 163.465 465.79 160.776C468.661 158.087 470.097 154.396 470.097 149.702V149.565C470.097 144.962 468.616 141.316 465.653 138.628C462.737 135.893 458.817 134.526 453.896 134.526H436.942V164.809Z"/>
                    <path d="M39.7354 102.061C32.3982 102.061 25.9496 101.081 20.3897 99.1216C14.8298 97.162 10.3181 94.3137 6.85458 90.5767C3.39104 86.7942 1.15797 82.2596 0.155362 76.9732C-0.0725024 75.8339 -0.0497159 74.8996 0.223722 74.1705C0.497159 73.4413 0.975675 72.8716 1.65927 72.4615C2.34286 72.0513 3.25432 71.8462 4.39364 71.8462H16.1515C17.0173 71.8462 17.7237 71.9374 18.2706 72.1197C18.863 72.302 19.3416 72.621 19.7061 73.0767C20.1163 73.4869 20.5037 74.0793 20.8683 74.854C21.643 76.9048 22.9418 78.6594 24.7647 80.1177C26.5877 81.5305 28.7979 82.647 31.3956 83.4673C34.0388 84.2421 36.9783 84.6294 40.214 84.6294C43.9054 84.6294 47.0955 84.1281 49.7843 83.1255C52.4731 82.1229 54.5466 80.7102 56.005 78.8873C57.5089 77.0643 58.2608 74.968 58.2608 72.5982V72.5298C58.2608 69.2942 56.962 66.7876 54.3643 65.0103C51.8123 63.1874 47.5056 61.6607 41.4444 60.4302L31.0538 58.3794C21.3468 56.4654 14.0095 53.1841 9.04208 48.5357C4.12021 43.8417 1.65927 37.7577 1.65927 30.2837V30.2154C1.65927 24.1542 3.27711 18.8677 6.51278 14.356C9.79403 9.79871 14.283 6.26683 19.9796 3.76031C25.7218 1.2538 32.2615 0.000549316 39.5987 0.000549316C46.7537 0.000549316 52.9972 1.04873 58.3292 3.14508C63.6612 5.19586 67.9451 8.11251 71.1808 11.8951C74.4164 15.632 76.49 20.0526 77.4015 25.1568C77.5838 26.2961 77.5382 27.2304 77.2647 27.9595C76.9913 28.6887 76.5128 29.2583 75.8292 29.6685C75.1456 30.0331 74.2569 30.2154 73.1632 30.2154H61.4054C60.5395 30.2154 59.8103 30.1242 59.2179 29.9419C58.671 29.7141 58.2153 29.3723 57.8507 28.9165C57.4861 28.4608 57.1443 27.8228 56.8253 27.0025C56.1417 24.9973 55.0024 23.2883 53.4073 21.8755C51.8123 20.4628 49.8298 19.369 47.46 18.5943C45.1358 17.8195 42.5154 17.4322 39.5987 17.4322C36.1808 17.4322 33.2413 17.9335 30.7804 18.9361C28.365 19.8931 26.4965 21.2375 25.1749 22.9693C23.8989 24.6555 23.2608 26.6379 23.2608 28.9165V28.9849C23.2608 31.9927 24.5597 34.4081 27.1573 36.231C29.755 38.0539 33.8337 39.5123 39.3936 40.606L49.7843 42.6568C56.7114 44.024 62.3852 45.9152 66.8058 48.3306C71.2263 50.746 74.5076 53.7994 76.6495 57.4908C78.7914 61.1822 79.8624 65.6027 79.8624 70.7525V70.8208C79.8624 77.2011 78.2673 82.7382 75.0772 87.4322C71.8871 92.1262 67.2843 95.7492 61.2686 98.3013C55.2986 100.808 48.1209 102.061 39.7354 102.061Z"/>
                    <path d="M96.2003 100.352C95.1521 100.352 94.2862 100.193 93.6026 99.8736C92.9646 99.5546 92.4861 99.0761 92.1671 98.438C91.8481 97.7544 91.6886 96.8886 91.6886 95.8404V6.22125C91.6886 5.17308 91.8481 4.32998 92.1671 3.69196C92.4861 3.00836 92.9646 2.50706 93.6026 2.18805C94.2862 1.86904 95.1521 1.70953 96.2003 1.70953H131.816C138.879 1.70953 145.009 3.12229 150.204 5.94781C155.445 8.77334 159.524 12.7382 162.441 17.8423C165.357 22.9465 166.816 28.8938 166.816 35.6841V35.8208C166.816 42.6568 165.357 48.6268 162.441 53.731C159.524 58.8352 155.445 62.8 150.204 65.6255C145.009 68.4055 138.879 69.7955 131.816 69.7955H113.29V95.8404C113.29 96.8886 113.131 97.7544 112.812 98.438C112.493 99.0761 111.991 99.5546 111.308 99.8736C110.67 100.193 109.827 100.352 108.778 100.352H96.2003ZM126.552 18.731H113.29V52.979H126.552C132.34 52.979 136.851 51.4979 140.087 48.5357C143.323 45.5735 144.941 41.358 144.941 35.8892V35.7525C144.941 30.2382 143.323 26.0227 140.087 23.106C136.851 20.1893 132.34 18.731 126.552 18.731Z"/>
                    <path d="M182.88 100.352C181.832 100.352 180.989 100.193 180.351 99.8736C179.713 99.5546 179.211 99.0761 178.847 98.438C178.528 97.7544 178.368 96.8886 178.368 95.8404V6.22125C178.368 5.17308 178.528 4.32998 178.847 3.69196C179.166 3.00836 179.644 2.50706 180.282 2.18805C180.966 1.86904 181.832 1.70953 182.88 1.70953H239.687C240.735 1.70953 241.578 1.86904 242.216 2.18805C242.9 2.50706 243.401 3.00836 243.72 3.69196C244.084 4.32998 244.267 5.17308 244.267 6.22125V14.9029C244.267 15.9511 244.084 16.8169 243.72 17.5005C243.401 18.1386 242.9 18.6171 242.216 18.9361C241.578 19.2551 240.735 19.4146 239.687 19.4146H200.038V42.1783H237.226C238.274 42.1783 239.117 42.3378 239.755 42.6568C240.393 42.9758 240.872 43.4771 241.191 44.1607C241.555 44.7987 241.737 45.6418 241.737 46.69V54.4146C241.737 55.5083 241.555 56.3742 241.191 57.0123C240.872 57.6503 240.393 58.1288 239.755 58.4478C239.117 58.7668 238.251 58.9263 237.157 58.9263H200.038V82.647H239.687C240.735 82.647 241.578 82.8065 242.216 83.1255C242.9 83.4445 243.401 83.9458 243.72 84.6294C244.084 85.2675 244.267 86.1106 244.267 87.1587V95.8404C244.267 96.8886 244.084 97.7544 243.72 98.438C243.401 99.0761 242.9 99.5546 242.216 99.8736C241.578 100.193 240.735 100.352 239.687 100.352H182.88Z"/>
                    <path d="M263.202 100.352C262.108 100.352 261.243 100.193 260.605 99.8736C259.967 99.5546 259.465 99.0761 259.101 98.438C258.782 97.7544 258.622 96.8886 258.622 95.8404V6.22125C258.622 5.17308 258.782 4.32998 259.101 3.69196C259.465 3.00836 259.967 2.50706 260.605 2.18805C261.243 1.86904 262.108 1.70953 263.202 1.70953H275.78C276.829 1.70953 277.672 1.86904 278.31 2.18805C278.948 2.50706 279.426 3.00836 279.745 3.69196C280.11 4.32998 280.292 5.17308 280.292 6.22125V82.647H318.368C319.416 82.647 320.26 82.8065 320.898 83.1255C321.581 83.4445 322.082 83.9458 322.401 84.6294C322.72 85.2675 322.88 86.1106 322.88 87.1587V95.8404C322.88 96.8886 322.72 97.7544 322.401 98.438C322.082 99.0761 321.581 99.5546 320.898 99.8736C320.26 100.193 319.416 100.352 318.368 100.352H263.202Z"/>
                    <path d="M339.218 100.352C338.124 100.352 337.258 100.193 336.62 99.8736C335.982 99.5546 335.481 99.0761 335.116 98.438C334.797 97.7544 334.638 96.8886 334.638 95.8404V6.22125C334.638 5.17308 334.797 4.32998 335.116 3.69196C335.481 3.00836 335.982 2.50706 336.62 2.18805C337.258 1.86904 338.124 1.70953 339.218 1.70953H351.796C352.844 1.70953 353.687 1.86904 354.325 2.18805C354.963 2.50706 355.442 3.00836 355.761 3.69196C356.125 4.32998 356.308 5.17308 356.308 6.22125V82.647H394.384C395.432 82.647 396.275 82.8065 396.913 83.1255C397.597 83.4445 398.098 83.9458 398.417 84.6294C398.736 85.2675 398.896 86.1106 398.896 87.1587V95.8404C398.896 96.8886 398.736 97.7544 398.417 98.438C398.098 99.0761 397.597 99.5546 396.913 99.8736C396.275 100.193 395.432 100.352 394.384 100.352H339.218Z"/>
                    <path d="M430.468 2C431.846 2.00009 432.963 3.11256 432.963 4.48485V12.1602C456.468 19.5925 473.5 41.5028 473.5 67.3766C473.5 97.2621 450.777 121.861 421.602 124.968C418.163 125.334 415.35 122.506 415.35 119.061V114.606C415.35 111.161 418.17 108.418 421.589 107.9C430.607 106.534 438.662 102.252 444.757 96.0513L415.65 67.3766V26.3875C415.55 26.3868 415.45 26.3856 415.35 26.3856C394.743 26.3858 377.675 41.4727 374.668 61.1621C374.148 64.5678 371.394 67.3765 367.936 67.3766H363.462C360.004 67.3765 357.164 64.5742 357.532 61.1487C360.024 37.9277 376.293 18.8111 398.038 12.0656V4.48485C398.038 3.11251 399.155 2 400.533 2H430.468Z"/>
                </svg>
            </div>
            {
                isPlaygroundButtonShown &&
                <PlayButton small={true} className='header__button'/>
            }
            <LangSelector className='header__langSelector'/>
        </div>
    );
} ;

export default Header;

